# Internationalization (i18n)

## Overview

Mobius uses `react-i18next` for internationalization, supporting multiple languages and regional customization. The application currently supports English and Spanish, with a flexible architecture for adding additional languages.

## i18n Architecture

```
┌─────────────────────────────────────────────────────────┐
│                  Component Layer                        │
│                 (useTranslation)                        │
└─────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────┐
│                   i18next Layer                         │
│  ┌──────────────┐ ┌──────────────┐ ┌─────────────────┐  │
│  │ Translation  │ │  Language    │ │   Formatters    │  │
│  │  Functions   │ │  Detection   │ │  (Date/Number)  │  │
│  └──────────────┘ └──────────────┘ └─────────────────┘  │
└─────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────┐
│                 Translation Files                       │
│  ┌──────────────┐ ┌──────────────┐ ┌─────────────────┐  │
│  │   English    │ │   Spanish    │ │   Additional    │  │
│  │   (/en/)     │ │   (/es/)     │ │   Languages     │  │
│  └──────────────┘ └──────────────┘ └─────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

## Configuration

### i18n Setup
**Location**: `src/translations/index.ts`

```typescript
import i18n from 'i18next'
import { initReactI18next } from 'react-i18next'
import LanguageDetector from 'i18next-browser-languagedetector'

// Import translation files
import enCommon from './en/common.json'
import enEditor from './en/editor.json'
import enTemplates from './en/templates.json'
import esCommon from './es/common.json'
import esEditor from './es/editor.json'
import esTemplates from './es/templates.json'

const resources = {
  en: {
    common: enCommon,
    editor: enEditor,
    templates: enTemplates,
  },
  es: {
    common: esCommon,
    editor: esEditor,
    templates: esTemplates,
  },
}

i18n
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    resources,
    
    // Language detection options
    detection: {
      order: ['localStorage', 'navigator', 'htmlTag'],
      caches: ['localStorage'],
      lookupLocalStorage: 'i18nextLng',
    },
    
    // Fallback language
    fallbackLng: 'en',
    
    // Namespace configuration
    defaultNS: 'common',
    ns: ['common', 'editor', 'templates'],
    
    // Debug mode (only in development)
    debug: process.env.NODE_ENV === 'development',
    
    // Interpolation options
    interpolation: {
      escapeValue: false, // React already escapes values
    },
    
    // React specific options
    react: {
      useSuspense: false, // Disable suspense for SSR compatibility
    },
  })

export default i18n
```

## Translation File Structure

### Common Translations
**Location**: `src/translations/en/common.json`

```json
{
  "actions": {
    "save": "Save",
    "cancel": "Cancel",
    "delete": "Delete",
    "edit": "Edit",
    "create": "Create",
    "duplicate": "Duplicate",
    "download": "Download",
    "upload": "Upload",
    "preview": "Preview",
    "export": "Export",
    "import": "Import",
    "undo": "Undo",
    "redo": "Redo",
    "copy": "Copy",
    "paste": "Paste",
    "cut": "Cut"
  },
  "navigation": {
    "home": "Home",
    "dashboard": "Dashboard",
    "templates": "Templates",
    "projects": "Projects",
    "settings": "Settings",
    "help": "Help"
  },
  "messages": {
    "loading": "Loading...",
    "saving": "Saving...",
    "saved": "Saved successfully",
    "error": "An error occurred",
    "success": "Operation completed successfully",
    "confirm_delete": "Are you sure you want to delete this item?",
    "unsaved_changes": "You have unsaved changes. Do you want to save before leaving?"
  },
  "validation": {
    "required": "This field is required",
    "invalid_email": "Please enter a valid email address",
    "min_length": "Minimum {{count}} characters required",
    "max_length": "Maximum {{count}} characters allowed",
    "invalid_format": "Invalid format"
  }
}
```

### Editor-Specific Translations
**Location**: `src/translations/en/editor.json`

```json
{
  "panels": {
    "templates": "Templates",
    "customize": "Customize",
    "elements": "Elements",
    "images": "Images",
    "uploads": "Uploads",
    "text": "Text",
    "graphics": "Graphics",
    "layers": "Layers",
    "pixabay": "Pixabay",
    "pexels": "Pexels"
  },
  "tools": {
    "select": "Select",
    "text": "Text",
    "rectangle": "Rectangle",
    "circle": "Circle",
    "line": "Line",
    "arrow": "Arrow",
    "image": "Image",
    "video": "Video"
  },
  "properties": {
    "width": "Width",
    "height": "Height",
    "x_position": "X Position",
    "y_position": "Y Position",
    "rotation": "Rotation",
    "opacity": "Opacity",
    "fill_color": "Fill Color",
    "stroke_color": "Stroke Color",
    "stroke_width": "Stroke Width",
    "font_family": "Font Family",
    "font_size": "Font Size",
    "font_weight": "Font Weight",
    "text_align": "Text Alignment",
    "line_height": "Line Height",
    "letter_spacing": "Letter Spacing"
  },
  "canvas": {
    "zoom_in": "Zoom In",
    "zoom_out": "Zoom Out",
    "zoom_fit": "Fit to Screen",
    "zoom_actual": "Actual Size",
    "grid": "Grid",
    "rulers": "Rulers",
    "guides": "Guides"
  },
  "export": {
    "title": "Export Design",
    "format": "Format",
    "quality": "Quality",
    "size": "Size",
    "export_as_image": "Export as Image",
    "export_as_video": "Export as Video",
    "export_as_pdf": "Export as PDF",
    "manim_export": "Export to Manim"
  },
  "timeline": {
    "play": "Play",
    "pause": "Pause",
    "stop": "Stop",
    "duration": "Duration",
    "current_time": "Current Time",
    "add_keyframe": "Add Keyframe",
    "remove_keyframe": "Remove Keyframe"
  }
}
```

### Spanish Translations
**Location**: `src/translations/es/common.json`

```json
{
  "actions": {
    "save": "Guardar",
    "cancel": "Cancelar",
    "delete": "Eliminar",
    "edit": "Editar",
    "create": "Crear",
    "duplicate": "Duplicar",
    "download": "Descargar",
    "upload": "Subir",
    "preview": "Vista Previa",
    "export": "Exportar",
    "import": "Importar",
    "undo": "Deshacer",
    "redo": "Rehacer",
    "copy": "Copiar",
    "paste": "Pegar",
    "cut": "Cortar"
  },
  "navigation": {
    "home": "Inicio",
    "dashboard": "Panel",
    "templates": "Plantillas",
    "projects": "Proyectos",
    "settings": "Configuración",
    "help": "Ayuda"
  },
  "messages": {
    "loading": "Cargando...",
    "saving": "Guardando...",
    "saved": "Guardado exitosamente",
    "error": "Ha ocurrido un error",
    "success": "Operación completada exitosamente",
    "confirm_delete": "¿Está seguro de que desea eliminar este elemento?",
    "unsaved_changes": "Tiene cambios sin guardar. ¿Desea guardar antes de salir?"
  },
  "validation": {
    "required": "Este campo es obligatorio",
    "invalid_email": "Por favor ingrese un email válido",
    "min_length": "Se requieren mínimo {{count}} caracteres",
    "max_length": "Máximo {{count}} caracteres permitidos",
    "invalid_format": "Formato inválido"
  }
}
```

## Usage in Components

### Basic Translation Hook
```typescript
import { useTranslation } from 'react-i18next'

const MyComponent = () => {
  const { t } = useTranslation()
  
  return (
    <div>
      <h1>{t('common:navigation.home')}</h1>
      <button>{t('common:actions.save')}</button>
    </div>
  )
}
```

### Multiple Namespaces
```typescript
const EditorPanel = () => {
  const { t } = useTranslation(['editor', 'common'])
  
  return (
    <div>
      <h2>{t('editor:panels.templates')}</h2>
      <button>{t('common:actions.create')}</button>
    </div>
  )
}
```

### Interpolation
```typescript
const ValidationMessage = ({ minLength }) => {
  const { t } = useTranslation()
  
  return (
    <span className="error">
      {t('common:validation.min_length', { count: minLength })}
    </span>
  )
}
```

### Pluralization
```typescript
const ItemCounter = ({ count }) => {
  const { t } = useTranslation()
  
  return (
    <span>
      {t('items', { count })} {/* Automatically handles singular/plural */}
    </span>
  )
}

// In translation file:
// "items_one": "{{count}} item"
// "items_other": "{{count}} items"
```

## Language Switching

### Language Selector Component
```typescript
import { useTranslation } from 'react-i18next'
import { Select, Option } from 'baseui/select'

const LanguageSelector = () => {
  const { i18n, t } = useTranslation()
  
  const languages = [
    { value: 'en', label: 'English' },
    { value: 'es', label: 'Español' },
  ]
  
  const currentLanguage = languages.find(lang => lang.value === i18n.language)
  
  const handleLanguageChange = ({ value }) => {
    i18n.changeLanguage(value[0].value)
  }
  
  return (
    <Select
      options={languages}
      value={currentLanguage ? [currentLanguage] : []}
      onChange={handleLanguageChange}
      placeholder={t('common:select_language')}
    />
  )
}
```

### Programmatic Language Change
```typescript
import { useTranslation } from 'react-i18next'

const useLanguage = () => {
  const { i18n } = useTranslation()
  
  const changeLanguage = (lng: string) => {
    i18n.changeLanguage(lng)
    localStorage.setItem('i18nextLng', lng)
  }
  
  const getCurrentLanguage = () => i18n.language
  
  return {
    currentLanguage: i18n.language,
    changeLanguage,
    getCurrentLanguage,
  }
}
```

## Context-Aware Translations

### Custom Translation Hook
```typescript
import { useTranslation } from 'react-i18next'
import { useEditorType } from '~/hooks/useEditorType'

export const useEditorTranslations = () => {
  const { t } = useTranslation(['editor', 'common'])
  const editorType = useEditorType()
  
  const getEditorSpecificTranslation = (key: string) => {
    const editorKey = `${editorType.toLowerCase()}_${key}`
    return t(`editor:${editorKey}`, { defaultValue: t(`editor:${key}`) })
  }
  
  return {
    t,
    te: getEditorSpecificTranslation,
  }
}
```

## Date and Number Formatting

### Localized Formatting
```typescript
import { useTranslation } from 'react-i18next'

const useFormatting = () => {
  const { i18n } = useTranslation()
  
  const formatDate = (date: Date, options?: Intl.DateTimeFormatOptions) => {
    return new Intl.DateTimeFormat(i18n.language, {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      ...options,
    }).format(date)
  }
  
  const formatNumber = (number: number, options?: Intl.NumberFormatOptions) => {
    return new Intl.NumberFormat(i18n.language, options).format(number)
  }
  
  const formatCurrency = (amount: number, currency: string = 'USD') => {
    return new Intl.NumberFormat(i18n.language, {
      style: 'currency',
      currency,
    }).format(amount)
  }
  
  return {
    formatDate,
    formatNumber,
    formatCurrency,
  }
}
```

## Dynamic Loading

### Lazy Loading Translations
```typescript
import { lazy } from 'react'

const loadTranslations = async (language: string) => {
  const translations = await import(`../translations/${language}/index.js`)
  return translations.default
}

// Usage in component
const DynamicTranslations = () => {
  const [translations, setTranslations] = useState(null)
  const { i18n } = useTranslation()
  
  useEffect(() => {
    loadTranslations(i18n.language).then(setTranslations)
  }, [i18n.language])
  
  return translations ? <TranslatedContent translations={translations} /> : <Loading />
}
```

## RTL (Right-to-Left) Support

### RTL Configuration
```typescript
// In i18n configuration
const resources = {
  en: { /* English translations */ },
  ar: { /* Arabic translations */ },
  he: { /* Hebrew translations */ },
}

// RTL detection
const isRTL = (language: string): boolean => {
  return ['ar', 'he', 'fa', 'ur'].includes(language)
}

// Component with RTL support
const RTLWrapper = ({ children }) => {
  const { i18n } = useTranslation()
  const isRTLLanguage = isRTL(i18n.language)
  
  return (
    <div 
      dir={isRTLLanguage ? 'rtl' : 'ltr'}
      className={isRTLLanguage ? 'rtl' : 'ltr'}
    >
      {children}
    </div>
  )
}
```

## Testing Internationalization

### Translation Testing
```typescript
import { render } from '@testing-library/react'
import i18n from 'i18next'
import { I18nextProvider } from 'react-i18next'

const renderWithI18n = (component, language = 'en') => {
  i18n.changeLanguage(language)
  
  return render(
    <I18nextProvider i18n={i18n}>
      {component}
    </I18nextProvider>
  )
}

describe('MyComponent', () => {
  it('renders in English', () => {
    const { getByText } = renderWithI18n(<MyComponent />, 'en')
    expect(getByText('Save')).toBeInTheDocument()
  })
  
  it('renders in Spanish', () => {
    const { getByText } = renderWithI18n(<MyComponent />, 'es')
    expect(getByText('Guardar')).toBeInTheDocument()
  })
})
```

### Missing Translation Detection
```typescript
// Custom hook to detect missing translations
const useMissingTranslations = () => {
  const { i18n } = useTranslation()
  
  useEffect(() => {
    if (process.env.NODE_ENV === 'development') {
      i18n.on('missingKey', (lng, namespace, key) => {
        console.warn(`Missing translation: ${lng}:${namespace}:${key}`)
      })
    }
  }, [i18n])
}
```

## Best Practices

1. **Namespace Organization**: Group related translations in namespaces
2. **Key Naming**: Use descriptive, hierarchical keys (e.g., `editor.panels.templates`)
3. **Interpolation**: Use interpolation for dynamic content
4. **Pluralization**: Always consider plural forms for countable items
5. **Context**: Provide context for translators with comments
6. **Validation**: Validate translation completeness in CI/CD
7. **Fallbacks**: Always provide fallback translations
8. **Performance**: Lazy load translations for large applications
9. **Testing**: Test all language variants
10. **Accessibility**: Consider screen reader compatibility for all languages

## Adding New Languages

1. **Create Translation Files**:
   ```
   src/translations/fr/
   ├── common.json
   ├── editor.json
   └── templates.json
   ```

2. **Update i18n Configuration**:
   ```typescript
   import frCommon from './fr/common.json'
   
   const resources = {
     // existing languages
     fr: {
       common: frCommon,
       // ... other namespaces
     }
   }
   ```

3. **Add Language Option**:
   ```typescript
   const languages = [
     { value: 'en', label: 'English' },
     { value: 'es', label: 'Español' },
     { value: 'fr', label: 'Français' },
   ]
   ```

4. **Test New Language**: Ensure all components render correctly with the new language
